<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<script src="/js/Produto/listar.js"></script>
<div>
    <h1>Produtos cadastrados</h1>

    <div>
         <a class="btn btn-primary" id="btnCadastrarProdutos" href="/produtos/cadastrar">Cadastrar produto</a>
        <button onclick="window.print()" class="btn btn-primary btnExportarPdf">Exportar para PDF</button>
        <button id="btnExportarExcel" class="btn btn-primary btnExportarExcel">Exportar para Excel</button>
    </div>


    <table style="margin-top:10px" class="table table-stripped" id="tabelaProdutos">
        <thead>
            <th>Id</th>
            <th>Descrição</th>
            <th>Preço</th>
            <th>Quantidade</th>
            <th class="actions">Ações</th>
        </thead>
        <tbody>
            <% for(let i=0; i<lista.length; i++) { %>

                <tr>
                    <td><%= lista[i].proCodigo %></td>
                    <td><%= lista[i].proDescricao %></td>
                    <td><%= lista[i].proPreco %></td>
                    <td><%= lista[i].proQuantidade %></td>
                    <td class="actions">
                        <div>
                            <a href="/produtos/alterar/<%= lista[i].proCodigo %>" class="btn btn-primary">
                                <i class="fas fa-pen"></i>
                            </a>
                            <button data-id="<%= lista[i].proCodigo %>" class="btn btn-danger btnExclusao">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>

            <% } %>
        </tbody>
    </table>
    <script>
        document.querySelectorAll('.btnExclusao').forEach(function (button){
            button.addEventListener('click', function (event) {
            
                var produtoId = this.getAttribute('data-id');

            
                var confirmacao = confirm("Deseja realmente excluir este produto?");

            
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '/produtos/excluir';

            
                var inputId = document.createElement('input');
                inputId.type = 'hidden';
                inputId.name = 'id';
                inputId.value = produtoId;

                
                var inputConfirmacao = document.createElement('input');
                inputConfirmacao.type = 'hidden';
                inputConfirmacao.name = 'confirmacao';
            
                inputConfirmacao.value = confirmacao.toString();

            
                form.appendChild(inputId);
                form.appendChild(inputConfirmacao);

            
                document.body.appendChild(form);
                form.submit();

                
                if (!confirmacao) {
                    event.preventDefault();
                }
            });
        });
    </script>
</div>